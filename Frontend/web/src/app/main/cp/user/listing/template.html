<div class="content-cnt page-layout blank">
  <div class="header p-24 h-80" fxLayout="row" fxLayoutAlign="start center">
    <div fxFlex="50">
      <div fxLayout="row" fxLayoutAlign="start center">
        <mat-icon class="secondary-text s-18">home</mat-icon>
        <mat-icon class="secondary-text s-16">chevron_right</mat-icon>
        <span class="secondary-text">អ្នកប្រើប្រាស់</span>
        <mat-icon class="secondary-text s-16">chevron_right</mat-icon>
        <span class="secondary-text">ទាំងអស់
        </span>
      </div>
    </div>

    <div fxFlex="50" class="text-right">
      <button
        mat-stroked-button
        color="accent"
        [routerLink]="['/user/create']"
      >
        <mat-icon class="material-icons">add</mat-icon><span>បង្កើតថ្មី</span>
      </button>
    </div>
  </div>

  <div class="content">
    <div class="tab-content p-24">

      <!-- Search -->
      <section class="filter">
        <div fxLayout="row"  fxLayoutAlign="start center" >
          <!-- Search by name -->
          <mat-form-field class="p-16">
            <mat-label > ឈ្មោះ ឬ លេខទូរសព្ទ </mat-label>
            <input matInput (keyup.enter) = " listing() " [(ngModel)]=" key ">
          </mat-form-field>
          <!-- Button Search -->
          <div fxFlex>
            <button [disabled] = " isSearching " mat-icon-button  (click)=" listing()"   mat-fab color="blue" mat-mini-fab  > <mat-icon  >search</mat-icon></button> &nbsp;             
          </div> 
        </div>
      </section>

      <section class="listing">

        <div *ngIf = " isSearching "> <!-- Display when isSearching = true -->
          <mat-spinner style="margin: auto" diameter=" 70 "></mat-spinner>
        </div>

        <ng-container *ngIf = " !isSearching ">

          <table  *ngIf=" data?.length > 0 " class="custom-table">
            <thead>
              <tr>
                <th>ល.រ</th>
                <th>ឈ្មោះ</th> 
                <th>តួរនាទី</th> 
                <th>លេខទូរសព្ទ</th>      
                <th>អ៊ីម៉ែល</th>
                <th>ការកែប្រែចុងក្រោយ</th>
                <th>រូបភាព</th>
                <th>ស្ថានភាព</th>  
                <th></th>       
              </tr>
            </thead>
            <tbody>

              <tr *ngFor = "let row of data; let i = index; " [attr.data-index]="i">
                <td>{{ i + 1 }}</td>
                <td>{{ row?.name }}</td>
                <td>{{ row?.type?.name }}</td>
                <td>{{ row?.phone }}</td>
                <td>{{ row?.email }}</td>                       
                <td>{{ row?.created_at }}</td>

                <td>
                  <div class="p-8 text-left" >
                    <ng-container *ngIf=" row?.avatar ">
                        <img [src] = " fileUrl + row?.avatar " style="width:60px; height: 60px; margin: 10px 0;"/><br>
                    </ng-container>
                    <ng-container *ngIf=" !row?.avatar ">
                        <img src="static/icon/user.png" style="width:60px; height: 60px; margin: 10px 0;"/>
                    </ng-container>
                  </div>
                </td>

                <td>
                  <mat-slide-toggle [disabled] = " true "  [checked]=" row?.is_active == 1 "></mat-slide-toggle>
                </td>

                <td class="text-right">
                  <button  mat-icon-button  matTooltip="ផ្លាស់ប្តូរពាក្យសម្ងាត់" (click)="changePassword(row)" color="accent">
                    <mat-icon>vpn_key</mat-icon>
                  </button>

                  <button mat-icon-button matTooltip="កែប្រែ" [routerLink]="['/user/'+row?.id]"color="accent">
                    <mat-icon>remove_red_eye</mat-icon>
                  </button>

                  <button  mat-icon-button color="warn" (click)="onDelete(row)" matTooltip="លុប">
                    <mat-icon>delete</mat-icon>
                  </button>

                </td>
              </tr>
              
            </tbody>
          </table>

          <div *ngIf=" data?.length == 0 " fxLayout="column" fxLayoutAlign="center center" fxflex>
            <mat-icon role="img" class="mat-icon notranslate s-100 mb-16 select-message-icon hint-text material-icons mat-icon-no-color" aria-hidden="true"> toc </mat-icon>
            <span class="select-message-text hint-text"><span>គ្មានទិន្នន័យ</span></span>
          </div>

        </ng-container>

      </section>
        

    </div>
  </div>
  
</div>
